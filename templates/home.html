<!DOCTYPE html>
<html>

<head>
    <title>Tableau de bord</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>

<body>
    <div class="dashboard">
        <h1>Accueil</h1>
        <p>Bienvenue {{ name }} !</p>

        {% if name == 'user'%}
        <div class="all-managers">
            <form action="/home/" method="GET">Noms des managers du département :
                <select name="dept_no" onchange="this.form.submit()">
                    {% for dept in dept_no_list %}
                    {%if dept.dept_no == dept_no_chosen %}
                    <option selected>{{dept.dept_no}}</option>
                    {%else%}
                    <option>{{dept.dept_no}}</option>
                    {%endif%}
                    {% endfor %}
                </select>
            </form>
            <div>
                {% for employee in employees_names %}
                <li>{{employee.first_name}} {{employee.last_name}}</li>
                {% endfor %}
            </div>
        </div>

        <div class="all-salaries">
            <form action="/home/" method="GET">
                <label for="emp_emp_no">Numéro d'employé : </label>
                <input type="text" name="emp_emp_no" id="emp_emp_no" value="{{emp_emp_no}}" required>
                <div>
                    <input type="submit" value="OK">
                </div>
            </form>
            <div class="bar-chart">
                <canvas id="bar_chart"></canvas>
                <script>
                    window.chartColors = {
                        red: 'rgb(255, 99, 132)',
                        orange: 'rgb(255, 159, 64)',
                        yellow: 'rgb(255, 205, 86)',
                        green: 'rgb(75, 192, 192)',
                        blue: 'rgb(54, 162, 235)',
                        purple: 'rgb(153, 102, 255)',
                        grey: 'rgb(201, 203, 207)'
                    };
                    var color = Chart.helpers.color;
                    var barChartData = {
                        labels: [{% for item in bar_labels %}
                    "{{ item }}",
                        {% endfor %}],
                    datasets: [{
                        label: 'Salaires',
                        backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
                        borderColor: window.chartColors.blue,
                        borderWidth: 1,
                        data: [
                            {% for item in bar_values %}
                            "{{ item }}",
                    {% endfor %}
                    ]
                        }]
                    };
                    var ctx = document.getElementById('bar_chart').getContext('2d');
                    window.myBar = new Chart(ctx, {
                        type: 'bar',
                        data: barChartData,
                        options: {
                            responsive: true,
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Histogramme des salaires par période'
                            }
                        }
                    });
                </script>
            </div>
        </div>
        {%endif%}

        <a href='/logout/'>Se déconnecter</a>
    </div>
</body>

</html>